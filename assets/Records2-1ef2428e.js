import{r as o,x as K,j as t,y as V}from"./index-0463e181.js";import{S as v}from"./react-select.esm-8c251536.js";import{a as C}from"./axios-7a713374.js";const m=p=>{if(!p)return 0;const y=p.trim().replace(/[()]/g,""),g=p.includes("(")?-1:1;return Number(y.replace(/,/g,""))*g};function Z(){const[p,y]=o.useState([["REGION","DATE RECD IN EMAIL","DATE OF SARO","ALLOTMENT NO.","PROGRAM","Notes/Validity","Total Amount","PAP","DESCRIPTION","CLASS TYPE","FUND TYPE","Object Code no.","Object Code Desc","AMOUNT","PURPOSE","REGION X","NCA AMOUNT","DATE","NCA NO.","BALANCE"]]),[g,L]=o.useState([["PAP","PAP CODE","DATE OF SARO","SARO NO","ALLOTMENT AMOUNT","OBJECT TITLE","OBJECT CODE","DATE OF OBLIGATION","Description - Fund Type","CLASS TYPE","fund source","ORS NO.","NAME OF CLAIMANT","PARTICULARS","OBLIGATED AMOUNT","DATE","ADA/CHECK","CASH","NON TRA","BALANCE"]]),[i,j]=o.useState(""),[r,b]=o.useState(""),[A,P]=o.useState(null),[n,S]=K();o.useEffect(()=>{const e=n.get("program"),s=n.get("allotment");e&&b(e),s&&j(s)},[n]);const F=e=>{const s=e?e.value:"";b(s),s?n.set("program",s):n.delete("program"),S(n)},U=e=>{const s=e?e.value:"";j(s),s?n.set("allotment",s):n.delete("allotment"),S(n)};function k(){C.get("11pC_pyDKZa797p_HUwt_PCfb7PLJUAtMDsfZ0MPepB4/values/MDS Regular R10",{headers:{Authorization:"Token 5f4a6fef4cb29b33296c4c9909cc8db05b86043141ba158a40dfbdc4d5a11a9a"}}).then(e=>{y(e.data.values)}).catch(e=>{console.log(e)})}function R(){C.get("1U4P9Up-0xNUlSsIX2DiIAIUZjnliHK8nAKMhQB7wXik/values/2025",{headers:{Authorization:"Token 5f4a6fef4cb29b33296c4c9909cc8db05b86043141ba158a40dfbdc4d5a11a9a"}}).then(e=>{L(e.data.values)}).catch(e=>{console.log(e)})}o.useEffect(()=>{k(),R()},[]);const I=[...new Set(p.slice(1).map(e=>e[3]))],D=[...new Set(p.slice(1).map(e=>e[8]))].map(e=>({value:e,label:e})),O=I.map(e=>({value:e,label:e})),l=p.filter((e,s)=>s===0||!r&&!i?!0:r&&i?e[8]===r&&e[3]===i:r?e[8]===r:i?e[3]===i:!0);o.useEffect(()=>{console.log("Selected Program:",r),console.log("Selected Allotment:",i),console.log("Filtered Data Length:",l.length)},[r,i,l]);const N=l.slice(1).reduce((e,s)=>{const x=s[13]?m(s[13]):0,u=g.slice(1).filter(d=>d[1]===s[7]&&d[3]===s[3]&&d[6]===s[11]).reduce((d,a)=>{const c=a[14]?m(a[14]):0;return d+c},0),T=x-u;return{amount:e.amount+x,obligation:e.obligation+u,unobligated:e.unobligated+T}},{amount:0,obligation:0,unobligated:0});return t.jsxs("div",{className:"h-full  w-[100%] mt-[10vh]",children:[t.jsxs("div",{className:"w-[100%] px-[2vw] flex items-center gap-5",children:[t.jsxs("div",{className:"mb-4  w-full",children:[t.jsx("label",{htmlFor:"program",className:"block text-sm font-medium text-gray-700",children:"Select Program"}),t.jsx(v,{id:"program",name:"program",options:D,value:D.find(e=>e.value===r),onChange:F,isClearable:!0,placeholder:"Search Program",className:"mt-1"})]}),t.jsxs("div",{className:"mb-4 w-full",children:[t.jsx("label",{htmlFor:"allotment",className:"block text-sm font-medium text-gray-700",children:"Select Allotment"}),t.jsx(v,{id:"allotment",name:"allotment",options:O,value:O.find(e=>e.value===i),onChange:U,isClearable:!0,placeholder:"Search Allotment",className:"mt-1"})]})]}),t.jsx("div",{className:"relative overflow-auto h-[70vh]",children:l.length<=0?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("p",{className:"text-gray-500 text-lg",children:"No records found! Kindly select a Program and Allotment if it is empty."})}):t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border",children:[t.jsx("thead",{className:"bg-[#e3ffe5] sticky top-0 border border-border",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[10%]",children:"ALLOTMENT NO."}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PROGRAM"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[300px]",children:"DESCRIPTION"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OBJ. CODE"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AMOUNT"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TOTAL OBLIGATION"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TOTAL UNOBLIGATED"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NTCA NUMBER"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DATE RECEIVED"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TOTAL"})]})}),t.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[r&&i&&l[1]&&t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][3]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][1]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][8]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][14]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][7]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][6]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][6]})]}),l.slice(1).map((e,s)=>{const x=g.slice(1).filter(a=>a[1]===e[7]&&a[3]===e[3]&&a[6]===e[11]);console.log(`${e[8]} - ${e[3]} - ${e[11]}`);const h=x.reduce((a,c)=>{const f=c[14]?m(c[14]):0;return a+f},0),u=a=>Number(a.replace(/,/g,"").trim()),d=(e[13]?u(e[13]):0)-h;return t.jsxs(V.Fragment,{children:[t.jsxs("tr",{className:"cursor-pointer hover:bg-gray-50",onClick:()=>P(A===s?null:s),children:[t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:r&&i?"":e[3]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:r&&i?"":e[1]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:r&&i?"":e[8]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[12]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[11]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[13]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 font-gsemibold hover:underline",children:h?h.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):""}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 font-gsemibold  hover:underline",children:d?d.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):""}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[18]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[17]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"})]}),A===s&&x.length>0&&t.jsx("tr",{children:t.jsx("td",{colSpan:11,className:"px-6 py-4",children:t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"text-sm font-bold mb-2",children:"Breakdown of Obligations"}),t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Details"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Date"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Payee"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"OBRs No."}),t.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Debit/Amount"}),t.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Credit"}),t.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Balance"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{colSpan:4,className:"px-4 py-2 text-sm text-gray-500",children:"Initial Amount"}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:e[13]}),t.jsx("td",{}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:e[13]})]}),x.map((a,c)=>{const f=m(e[13]),E=m(a[14]),M=x.slice(0,c).reduce((G,$)=>G+m($[14]),0),B=f-M-E;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:a[12]}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:a[7]}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:a[1]}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:`${a[9]}-${a[10]}-${a[11]}`}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right"}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:E.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:B.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})]},c)})]}),t.jsx("tfoot",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:4,className:"px-4 py-2 font-bold",children:"Total"}),t.jsx("td",{className:"px-4 py-2 text-right font-bold"}),t.jsx("td",{className:"px-4 py-2 text-right font-bold",children:x.reduce((a,c)=>a+m(c[14]),0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}),t.jsx("td",{className:"px-4 py-2 text-right font-bold",children:(m(e[13])-x.reduce((a,c)=>a+m(c[14]),0)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})]})})]})]})})})]},s)})]}),t.jsx("tfoot",{className:"bg-[#e3ffe5] sticky bottom-0 border border-border",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:5,className:"px-6 py-3 text-sm font-bold text-gray-700",children:"TOTAL"}),t.jsx("td",{className:"px-6 py-3 text-sm font-bold text-gray-700",children:N.amount.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3})}),t.jsx("td",{className:"px-6 py-3 text-sm font-bold text-gray-700",children:N.obligation.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3})}),t.jsx("td",{className:"px-6 py-3 text-sm font-bold text-gray-700",children:N.unobligated.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3})}),t.jsx("td",{colSpan:3})]})})]})})]})}export{Z as default};
