import{r as o,x as $,j as t,y as J}from"./index-d57b36ca.js";import{S as E}from"./react-select.esm-6c2e05eb.js";import{a as L}from"./axios-7a713374.js";const n=m=>{if(!m)return 0;const u=m.trim().replace(/[()]/g,""),g=m.includes("(")?-1:1;return Number(u.replace(/,/g,""))*g};function X(){const[m,u]=o.useState([["ALLOTMENT NO.","Date","PROGRAM","DESCRIPTION","OBJ. CODE","AMOUNT","TOTAL OBLIGATION","TOTAL UNOBLIGATED","NTCA NUMBER","DATE RECEIVED","TOTAL"],["2024-01-0002","01/19/2024","PS","Traveling Expenses - Local","5020101000",479300,293442.07,185857.93,"NTCA-12346","01/20/2024",838655.24]]),[g,C]=o.useState([["ALLOTMENT NO.","Date","PROGRAM","DESCRIPTION","OBJ. CODE","AMOUNT","TOTAL OBLIGATION","TOTAL UNOBLIGATED","NTCA NUMBER","DATE RECEIVED","TOTAL"],["2024-01-0002","01/19/2024","PS","Traveling Expenses - Local","5020101000",479300,293442.07,185857.93,"NTCA-12346","01/20/2024",838655.24]]),[p,f]=o.useState(""),[d,b]=o.useState(""),[T,F]=o.useState(null),[x,S]=$();o.useEffect(()=>{const e=x.get("program"),s=x.get("allotment");e&&b(e),s&&f(s)},[x]);const P=e=>{const s=e?e.value:"";b(s),s?x.set("program",s):x.delete("program"),S(x)},U=e=>{const s=e?e.value:"";f(s),s?x.set("allotment",s):x.delete("allotment"),S(x)};function k(){L.get("1-iMx8U7brob8Gs-HuPhEkF8pIyu1aPOGLSmhwFa9oog/values/MDS REG R10",{headers:{Authorization:"Token 5f4a6fef4cb29b33296c4c9909cc8db05b86043141ba158a40dfbdc4d5a11a9a"}}).then(e=>{u(e.data.values)}).catch(e=>{console.log(e)})}function I(){L.get("1bZCLinN4S-F-jU6jsA90uxxXRCT5uUjcI9s6Mt5_QeI/values/year2024",{headers:{Authorization:"Token 5f4a6fef4cb29b33296c4c9909cc8db05b86043141ba158a40dfbdc4d5a11a9a"}}).then(e=>{C(e.data.values)}).catch(e=>{console.log(e)})}o.useEffect(()=>{k(),I()},[]);const M=[...new Set(m.slice(1).map(e=>e[3]))],A=[...new Set(m.slice(1).map(e=>e[7]))].map(e=>({value:e,label:e})),O=M.map(e=>({value:e,label:e})),l=d?m.filter((e,s)=>s===0||e[3]===p&&e[7]===d):m,N=l.slice(1).reduce((e,s)=>{const r=s[12]?n(s[12]):0,y=g.slice(1).filter(c=>c[0]===s[7]&&c[3]===s[3]&&c[5]===s[11]&&c.length>11).reduce((c,a)=>{const i=a[14]?n(a[14]):0;return c+i},0),D=r-y;return{amount:e.amount+r,obligation:e.obligation+y,unobligated:e.unobligated+D}},{amount:0,obligation:0,unobligated:0});return t.jsxs("div",{className:"h-full  w-[100%] mt-[10vh]",children:[t.jsxs("div",{className:"w-[100%] px-[2vw] flex items-center gap-5",children:[t.jsxs("div",{className:"mb-4  w-full",children:[t.jsx("label",{htmlFor:"program",className:"block text-sm font-medium text-gray-700",children:"Select Program"}),t.jsx(E,{id:"program",name:"program",options:A,value:A.find(e=>e.value===d),onChange:P,isClearable:!0,placeholder:"Search Program",className:"mt-1"})]}),t.jsxs("div",{className:"mb-4 w-full",children:[t.jsx("label",{htmlFor:"allotment",className:"block text-sm font-medium text-gray-700",children:"Select Allotment"}),t.jsx(E,{id:"allotment",name:"allotment",options:O,value:O.find(e=>e.value===p),onChange:U,isClearable:!0,placeholder:"Search Allotment",className:"mt-1"})]})]}),t.jsx("div",{className:"relative overflow-auto h-[70vh]",children:l.length<=1?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("p",{className:"text-gray-500 text-lg",children:"No records found! Kindly select a Program and Allotment if it is empty."})}):t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border",children:[t.jsx("thead",{className:"bg-[#e3ffe5] sticky top-0 border border-border",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[10%]",children:"ALLOTMENT NO."}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PROGRAM"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[300px]",children:"DESCRIPTION"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OBJ. CODE"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AMOUNT"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TOTAL OBLIGATION"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TOTAL UNOBLIGATED"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"NTCA NUMBER"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"DATE RECEIVED"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"TOTAL"})]})}),t.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[d&&p&&l[1]&&t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][3]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][1]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][7]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][13]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][6]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][5]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:l[1][5]})]}),l.slice(1).map((e,s)=>{const r=g.slice(1).filter(a=>a[0]===e[7]&&a[3]===e[3]&&a[5]===e[11]&&a.length>11);console.log(r,` ---${e[11]}`);const h=r.reduce((a,i)=>{const j=i[14]?n(i[14]):0;return a+j},0),y=a=>Number(a.replace(/,/g,"").trim()),c=(e[12]?y(e[12]):0)-h;return t.jsxs(J.Fragment,{children:[t.jsxs("tr",{className:"cursor-pointer hover:bg-gray-50",onClick:()=>F(T===s?null:s),children:[t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:d&&p?"":e[3]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:d&&p?"":e[1]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:d&&p?"":e[7]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[11]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[10]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e[12]}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 font-gsemibold hover:underline",children:h?h.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):""}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 font-gsemibold  hover:underline",children:c?c.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}):""}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500"})]}),T===s&&r.length>0&&t.jsx("tr",{children:t.jsx("td",{colSpan:11,className:"px-6 py-4",children:t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"text-sm font-bold mb-2",children:"Breakdown of Obligations"}),t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Details"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Date"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"Payee"}),t.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500",children:"OBRs No."}),t.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Debit/Amount"}),t.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Credit"}),t.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500",children:"Balance"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{colSpan:4,className:"px-4 py-2 text-sm text-gray-500",children:"Initial Amount"}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:e[12]}),t.jsx("td",{}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:e[12]})]}),r.map((a,i)=>{const j=n(e[12]),v=n(a[14]),B=r.slice(0,i).reduce((G,V)=>G+n(V[14]),0),R=j-B-v;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:a[12]}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:a[7]}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:a[1]}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:`${a[9]}-${a[10]}-${a[11]}`}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right"}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:v.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}),t.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 text-right",children:R.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})]},i)})]}),t.jsx("tfoot",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:4,className:"px-4 py-2 font-bold",children:"Total"}),t.jsx("td",{className:"px-4 py-2 text-right font-bold"}),t.jsx("td",{className:"px-4 py-2 text-right font-bold",children:r.reduce((a,i)=>a+n(i[14]),0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}),t.jsx("td",{className:"px-4 py-2 text-right font-bold",children:(n(e[12])-r.reduce((a,i)=>a+n(i[14]),0)).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})]})})]})]})})})]},s)})]}),t.jsx("tfoot",{className:"bg-[#e3ffe5] sticky bottom-0 border border-border",children:t.jsxs("tr",{children:[t.jsx("td",{colSpan:5,className:"px-6 py-3 text-sm font-bold text-gray-700",children:"TOTAL"}),t.jsx("td",{className:"px-6 py-3 text-sm font-bold text-gray-700",children:N.amount.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3})}),t.jsx("td",{className:"px-6 py-3 text-sm font-bold text-gray-700",children:N.obligation.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3})}),t.jsx("td",{className:"px-6 py-3 text-sm font-bold text-gray-700",children:N.unobligated.toLocaleString("en-US",{minimumFractionDigits:3,maximumFractionDigits:3})}),t.jsx("td",{colSpan:3})]})})]})})]})}export{X as default};
